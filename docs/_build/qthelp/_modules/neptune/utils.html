<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>neptune.utils</title>
    <link rel="stylesheet" href="../../_static/nonav.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for neptune.utils</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright (c) 2019, Neptune Labs Sp. z o.o.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">glob</span> <span class="k">as</span> <span class="nn">globlib</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bravado.exception</span> <span class="k">import</span> <span class="n">BravadoConnectionError</span><span class="p">,</span> <span class="n">BravadoTimeoutError</span><span class="p">,</span> <span class="n">HTTPForbidden</span><span class="p">,</span> \
    <span class="n">HTTPInternalServerError</span><span class="p">,</span> <span class="n">HTTPServerError</span><span class="p">,</span> <span class="n">HTTPUnauthorized</span><span class="p">,</span> <span class="n">HTTPServiceUnavailable</span><span class="p">,</span> <span class="n">HTTPRequestTimeout</span><span class="p">,</span> \
    <span class="n">HTTPGatewayTimeout</span><span class="p">,</span> <span class="n">HTTPBadGateway</span>

<span class="kn">from</span> <span class="nn">neptune.api_exceptions</span> <span class="k">import</span> <span class="n">ConnectionLost</span><span class="p">,</span> <span class="n">Forbidden</span><span class="p">,</span> <span class="n">ServerError</span><span class="p">,</span> \
    <span class="n">Unauthorized</span><span class="p">,</span> <span class="n">SSLError</span>
<span class="kn">from</span> <span class="nn">neptune.exceptions</span> <span class="k">import</span> <span class="n">InvalidNotebookPath</span><span class="p">,</span> <span class="n">FileNotFound</span><span class="p">,</span> <span class="n">NotAFile</span>
<span class="kn">from</span> <span class="nn">neptune.git_info</span> <span class="k">import</span> <span class="n">GitInfo</span>

<span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">IS_WINDOWS</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;getwindowsversion&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">map_values</span><span class="p">(</span><span class="n">f_value</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">f_value</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">map_keys</span><span class="p">(</span><span class="n">f_key</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">f_key</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">as_list</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">validate_notebook_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ipynb&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidNotebookPath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">FileNotFound</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NotAFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">align_channels_on_x</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>
    <span class="n">channel_dfs</span><span class="p">,</span> <span class="n">common_x</span> <span class="o">=</span> <span class="n">_split_df_by_stems</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merge_dataframes</span><span class="p">([</span><span class="n">common_x</span><span class="p">]</span> <span class="o">+</span> <span class="n">channel_dfs</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_channel_name_stems</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">merge_dataframes</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">):</span>
    <span class="n">merged_df</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> \
                                     <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">how</span><span class="p">),</span> <span class="n">dataframes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged_df</span>


<span class="k">def</span> <span class="nf">is_float</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">is_nan_or_inf</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">file_contains</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">in_docker</span><span class="p">():</span>
    <span class="n">cgroup_file</span> <span class="o">=</span> <span class="s1">&#39;/proc/self/cgroup&#39;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./dockerenv&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cgroup_file</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file_contains</span><span class="p">(</span><span class="n">cgroup_file</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;docker&#39;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">is_notebook</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># pylint: disable=pointless-statement,undefined-variable</span>
        <span class="n">get_ipython</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_split_df_by_stems</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">channel_dfs</span><span class="p">,</span> <span class="n">x_vals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">stem</span> <span class="ow">in</span> <span class="n">get_channel_name_stems</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">channel_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;x_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stem</span><span class="p">),</span> <span class="s1">&#39;y_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stem</span><span class="p">)]]</span>
        <span class="n">channel_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">stem</span><span class="p">]</span>
        <span class="n">channel_df</span> <span class="o">=</span> <span class="n">channel_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">channel_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_df</span><span class="p">)</span>
        <span class="n">x_vals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">channel_df</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">common_x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)},</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">channel_dfs</span><span class="p">,</span> <span class="n">common_x</span>


<span class="k">def</span> <span class="nf">discover_git_repo_location</span><span class="p">():</span>
    <span class="c1"># pylint:disable=bad-option-value,import-outside-toplevel</span>
    <span class="kn">import</span> <span class="nn">__main__</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">__main__</span><span class="p">,</span> <span class="s1">&#39;__file__&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__main__</span><span class="o">.</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">update_session_proxies</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">proxies</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">proxies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">proxies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Wrong proxies format: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">proxies</span><span class="p">))</span>


<div class="viewcode-block" id="get_git_info"><a class="viewcode-back" href="../../neptune-client/docs/utils.html#neptune.utils.get_git_info">[docs]</a><span class="k">def</span> <span class="nf">get_git_info</span><span class="p">(</span><span class="n">repo_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieve information about git repository.</span>

<span class="sd">    If attempt fails, ``None`` will be returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        repo_path (:obj:`str`, optional, default is ``None``):</span>

<span class="sd">            | Path to the repository from which extract information about git.</span>
<span class="sd">            | If ``None`` is passed, calling ``get_git_info`` is equivalent to calling</span>
<span class="sd">              ``git.Repo(search_parent_directories=True)``.</span>
<span class="sd">              Check `GitPython &lt;https://gitpython.readthedocs.io/en/stable/reference.html#git.repo.base.Repo&gt;`_</span>
<span class="sd">              docs for more information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :class:`~neptune.git_info.GitInfo` - An object representing information about git repository.</span>

<span class="sd">    Examples:</span>

<span class="sd">        .. code:: python3</span>

<span class="sd">            # Get git info from the current directory</span>
<span class="sd">            git_info = get_git_info(&#39;.&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># pylint:disable=bad-option-value,import-outside-toplevel</span>
        <span class="kn">import</span> <span class="nn">git</span>

        <span class="n">repo</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">Repo</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span> <span class="n">search_parent_directories</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">commit</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">commit</span>

        <span class="n">active_branch</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">active_branch</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">active_branch</span><span class="o">.</span><span class="n">name</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;HEAD is a detached symbolic reference as it points to&quot;</span><span class="p">):</span>
                <span class="n">active_branch</span> <span class="o">=</span> <span class="s2">&quot;Detached HEAD&quot;</span>

        <span class="n">remote_urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">url</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="n">repo</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">GitInfo</span><span class="p">(</span>
            <span class="n">commit_id</span><span class="o">=</span><span class="n">commit</span><span class="o">.</span><span class="n">hexsha</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="n">commit</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
            <span class="n">author_name</span><span class="o">=</span><span class="n">commit</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">author_email</span><span class="o">=</span><span class="n">commit</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="n">commit_date</span><span class="o">=</span><span class="n">commit</span><span class="o">.</span><span class="n">committed_datetime</span><span class="p">,</span>
            <span class="n">repository_dirty</span><span class="o">=</span><span class="n">repo</span><span class="o">.</span><span class="n">is_dirty</span><span class="p">(</span><span class="n">untracked_files</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">active_branch</span><span class="o">=</span><span class="n">active_branch</span><span class="p">,</span>
            <span class="n">remote_urls</span><span class="o">=</span><span class="n">remote_urls</span>
        <span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>  <span class="c1"># pylint: disable=bare-except</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="k">def</span> <span class="nf">with_api_exceptions_handler</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">retry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">SSLError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SSLError</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">BravadoConnectionError</span><span class="p">,</span> <span class="n">BravadoTimeoutError</span><span class="p">,</span>
                    <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">,</span>
                    <span class="n">HTTPRequestTimeout</span><span class="p">,</span> <span class="n">HTTPServiceUnavailable</span><span class="p">,</span> <span class="n">HTTPGatewayTimeout</span><span class="p">,</span> <span class="n">HTTPBadGateway</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">retry</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Experiencing connection interruptions. Reestablishing communication with Neptune.&#39;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">retry</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">except</span> <span class="n">HTTPServerError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ServerError</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">HTTPUnauthorized</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Unauthorized</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">HTTPForbidden</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Forbidden</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="n">status_code</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
                <span class="k">if</span> <span class="n">status_code</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="n">HTTPBadGateway</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                        <span class="n">HTTPServiceUnavailable</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                        <span class="n">HTTPGatewayTimeout</span><span class="o">.</span><span class="n">status_code</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">retry</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s1">&#39;Experiencing connection interruptions. Reestablishing communication with Neptune.&#39;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">retry</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">status_code</span> <span class="o">&gt;=</span> <span class="n">HTTPInternalServerError</span><span class="o">.</span><span class="n">status_code</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ServerError</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPUnauthorized</span><span class="o">.</span><span class="n">status_code</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">Unauthorized</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">status_code</span> <span class="o">==</span> <span class="n">HTTPForbidden</span><span class="o">.</span><span class="n">status_code</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">Forbidden</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">ConnectionLost</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
    <span class="c1"># pylint: disable=unexpected-keyword-arg</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">minor</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">globlib</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">globlib</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>


  <script src="/docker-config.js"></script>
  <script>
    /* !
     * JavaScript Cookie v2.2.1
     * https://github.com/js-cookie/js-cookie
     *
     * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
     * Released under the MIT license
     *
     * Minified by jsDelivr using Terser v3.14.1.
     * Original file: /npm/js-cookie@2.2.1/src/js.cookie.js
     *
     * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
     */
    !function(e){var n;if("function"==typeof define&&define.amd&&(define(e),n=!0),"object"==typeof exports&&(module.exports=e(),n=!0),!n){var t=window.Cookies,o=window.Cookies=e();o.noConflict=function(){return window.Cookies=t,o}}}(function(){function e(){for(var e=0,n={};e<arguments.length;e++){var t=arguments[e];for(var o in t)n[o]=t[o]}return n}function n(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function t(o){function r(){}function i(n,t,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},r.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var c=JSON.stringify(t);/^[\{\[]/.test(c)&&(t=c)}catch(e){}t=o.write?o.write(t,n):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=encodeURIComponent(String(n)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var f="";for(var u in i)i[u]&&(f+="; "+u,!0!==i[u]&&(f+="="+i[u].split(";")[0]));return document.cookie=n+"="+t+f}}function c(e,t){if("undefined"!=typeof document){for(var r={},i=document.cookie?document.cookie.split("; "):[],c=0;c<i.length;c++){var f=i[c].split("="),u=f.slice(1).join("=");t||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var a=n(f[0]);if(u=(o.read||o)(u,a)||n(u),t)try{u=JSON.parse(u)}catch(e){}if(r[a]=u,e===a)break}catch(e){}}return e?r[e]:r}}return r.set=i,r.get=function(e){return c(e,!1)},r.getJSON=function(e){return c(e,!0)},r.remove=function(n,t){i(n,"",e(t,{expires:-1}))},r.defaults={},r.withConverter=t,r}(function(){})});
  </script>

  <script>
    function initGA(isProduction) {
      if (!isProduction) {
        // eslint-disable-next-line no-console
        console.warn('GA will not load in development mode');
        return;
      }

      /* eslint-disable */
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-102823704-1', 'auto');
      ga('send', 'pageview');
      /* eslint-enable */
    }

    initGA(window.dockerConfig.isProduction);
  </script>

  <script>
    /* global heap, hj */

    var options = {
      devel: {
        appId: 569758,
      },
      prod: {
        appId: 569747,
      },
    };

    function initHotJar(isProduction) {
      var appId = getAppId(isProduction);

      appendHotJarScript(appId);
      tagRecording();
    }

    function appendHotJarScript(appId) {
      (function (h, o, t, j, a, r) {
        h.hj = h.hj || function () {
          (h.hj.q = h.hj.q || []).push(arguments);
        };
        h._hjSettings = {hjid: appId, hjsv: 5};
        a = o.getElementsByTagName('head')[0];
        r = o.createElement('script');
        r.async = 1;
        r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
        a.appendChild(r);
      })(window, document, '//static.hotjar.com/c/hotjar-', '.js?sv=');
    }

    function getAppId(isProduction) {
      return isProduction ? options.prod.appId : options.devel.appId;
    }

    function tagRecording() {
      var TAG_RECORDING_DELAY = 5 * 1000;

      if (canSafelyTagRecording()) {
        hj('tagRecording', [ heap.identity ]);
      } else {

        // try until all needed libs and data is available
        window.setTimeout(tagRecording, TAG_RECORDING_DELAY);
      }
    }

    function canSafelyTagRecording() {
      return (
        typeof hj === 'function'
        && typeof heap === 'object'
        && typeof heap.identity === 'string'
        && heap.identity.length > 0
      );
    }

    initHotJar(window.dockerConfig.isProduction);
  </script>

  <script>
    function initIntercom(isProduction) {
      var options = {
        devel: {
          appId: 'wqilukic',
        },
        prod: {
          appId: 'yoy39he9',
        },
      };

      var username = window.Cookies.get('neptune-uid');

      window.intercomSettings = {
        app_id: getAppId(isProduction),
      };

      var isUsernamePreserved = typeof username === 'string' && username.length > 0;
      if (isUsernamePreserved) {
        window.intercomSettings.user_id = username;
      }

      function getAppId(isProduction) {
        return isProduction ? options.prod.appId : options.devel.appId;
      }


      // Intercom official integration code
      // eslint-disable-next-line
      (function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/wqilukic';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
      // Intercom official integration code
    }

    initIntercom(window.dockerConfig.isProduction);
  </script>


  </body>
</html>